<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Segudab — Catálogo de productos</title>

  <style>
    :root {
      --color-bg-dark: #050505;
      --color-bg-light: #f5f5f5;
      --color-primary: #e00000;
      --color-primary-dark: #b30000;
      --color-accent: #f4c542;
      --color-text: #111111;
      --max-width: 1200px;
    }

    * { box-sizing: border-box; }
    html, body { margin:0; width:100%; overflow-x:hidden; }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--color-bg-light);
    }

    .top-bar {
      background: #000;
      color: #fff;
      font-size: 13px;
      padding: 6px 16px;
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
      text-align: center;
    }
    .top-bar span{ white-space: nowrap; }

    header {
      background: #000;
      color: #fff;
      padding: 12px 30px;
      position: sticky;
      top: 0;
      z-index: 999;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    .nav-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      position: relative;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      text-decoration: none;
      min-width: 0;
    }

    .logo-img {
      width: 48px;
      height: 48px;
      border-radius: 6px;
      background: url('logo.png') center/cover no-repeat;
      flex: 0 0 auto;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      font-size: 13px;
      text-transform: uppercase;
      line-height: 1.1;
      min-width: 0;
    }

    .logo-text strong {
      font-size: 20px;
      letter-spacing: 1px;
    }

    .logo-text span{
      opacity: .9;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 360px;
    }

    nav {
      display: flex;
      gap: 20px;
      font-size: 14px;
      text-transform: uppercase;
      align-items: center;
    }

    .nav-link{
      color: #fff;
      padding-bottom: 3px;
      border-bottom: 2px solid transparent;
      transition: .2s;
      text-decoration: none;
      position: relative;
      display: inline-block;
      -webkit-tap-highlight-color: transparent;
    }

    .nav-link:hover {
      border-color: var(--color-primary);
      color: var(--color-accent);
    }

    .nav-cta {
      background: var(--color-primary);
      padding: 8px 16px;
      border-radius: 999px;
      font-weight: 600;
      border-bottom: none;
    }
    .nav-cta:hover { background: var(--color-primary-dark); color:#fff; }

    .nav-item { position: relative; }
    .nav-link .caret { font-size: 10px; margin-left: 4px; }

    .dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      background: #000;
      min-width: 200px;
      padding: 10px 0;
      box-shadow: 0 8px 18px rgba(0,0,0,0.6);
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity .15s ease, transform .15s ease;
      z-index: 9999;
      border-top: 2px solid var(--color-accent);
    }

    .nav-item:hover .dropdown {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    .nav-item.open .dropdown {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .dropdown a {
      display: block;
      padding: 8px 18px;
      font-size: 13px;
      color: #fff;
      text-decoration: none;
      border-bottom: none;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .dropdown a:hover {
      background: #111;
      color: var(--color-accent);
    }

    .mobile-toggle{
      display:none;
      border:none;
      background:transparent;
      color:#fff;
      cursor:pointer;
      padding:6px;
      flex:0 0 auto;
      margin-left:auto;
      -webkit-tap-highlight-color: transparent;
    }
    .mobile-toggle:focus{ outline:none; }
    .mobile-toggle:focus-visible{
      outline:2px solid rgba(244,197,66,.55);
      outline-offset:4px;
      border-radius:10px;
    }

    .hamb{
      display:flex;
      flex-direction:column;
      gap:6px;
      width:28px;
      align-items:flex-end;
    }
    .hamb span{
      height:2px;
      width:26px;
      background:#fff;
      border-radius:2px;
      display:block;
    }

    .nav-overlay{
      display:none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: 9998;
    }

    .hero {
      background: radial-gradient(circle at top left, #333 0, #000 45%, #111 100%);
      color: #fff;
      padding: 60px 20px;
    }

    .hero-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: center;
    }

    .hero-title {
      font-size: 40px;
      text-transform: uppercase;
      font-weight: 800;
    }

    .hero-subtitle {
      font-size: 18px;
      text-transform: uppercase;
      color: #ddd;
      margin-bottom: 12px;
    }

    .hero-text {
      color: #ddd;
      max-width: 480px;
      margin-bottom: 20px;
      font-size: 15px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      padding: 12px 24px;
      border-radius: 999px;
      text-transform: uppercase;
      font-weight: 600;
      cursor: pointer;
      transition: .15s;
      text-decoration: none;
      border: none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-primary {
      background: var(--color-primary);
      color: #fff;
      box-shadow: 0 6px 14px rgba(224,0,0,0.5);
    }

    .btn-primary:hover { background: var(--color-primary-dark); }
    .hero-buttons { margin-top: 12px; }

    .notice-bar {
      background: var(--color-primary);
      color: #fff;
      padding: 10px;
      text-align: center;
      font-size: 13px;
      margin-bottom: 20px;
    }

    .section { padding: 50px 20px; }
    .section-inner {
      max-width: var(--max-width);
      margin: 0 auto;
      text-align: left;
    }
    .section-title {
      font-size: 26px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .section-subtitle {
      font-size: 14px;
      color: #777;
      margin-bottom: 10px;
    }

    /* ✅ Layout: filtros arriba, productos, carrito abajo (en 1 columna) */
    .catalog-layout{
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 10px;
      display: block; /* antes era grid 2 columnas */
    }
    .catalog-main{ width: 100%; }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }

    .product-image {
      height: 170px;
      background-size: cover;
      background-position: center;
    }

    .product-image.product-image-contain {
      background-size: contain;
      background-position: top center;
      background-repeat: no-repeat;
      background-color: #fff;
    }

    .product-body { padding: 14px 16px 16px; text-align: left; }
    .product-name { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
    .product-desc { font-size: 13px; color: #555; margin-bottom: 8px; }

    .product-tag {
      display: inline-block;
      font-size: 11px;
      text-transform: uppercase;
      background: #eee;
      padding: 2px 8px;
      border-radius: 999px;
      margin-bottom: 8px;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .product-price { font-weight: 700; font-size: 15px; color: var(--color-primary); }

    .btn-small {
      padding: 8px 14px;
      font-size: 12px;
      border-radius: 999px;
      border: none;
      background: var(--color-primary);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-small:hover { background: var(--color-primary-dark); }

    .filters {
      background: #fff;
      padding: 16px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      text-align: left;
      width: 100%;
      margin-bottom: 16px; /* ✅ arriba del grid */
    }

    .filters h3 {
      margin: 0 0 10px;
      font-size: 16px;
      text-transform: uppercase;
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .filter-btn {
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      text-transform: uppercase;
    }

    .filter-btn:hover { background: #eee; }

    .filter-btn.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: #fff;
    }

    .filters-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 8px;
    }

    .filters-row label { font-size: 12px; color: #555; }

    .filters select,
    .filters input[type="text"] {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
      max-width: 220px;
    }

    .cart-panel {
      background: #fff;
      border-radius: 14px;
      padding: 16px 18px 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      position: static;      /* ✅ abajo del último producto */
      top: auto;
      font-size: 14px;
      max-width: 100%;
      width: 100%;
      text-align: left;
      margin-top: 18px;      /* ✅ separación con el grid */
    }

    .cart-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
    .cart-items {
      max-height: 220px;
      overflow-y: auto;
      margin-bottom: 10px;
      border-top: 1px solid #eee;
      border-bottom: 1px solid #eee;
      padding: 8px 0;
      font-size: 13px;
    }

    .cart-item { margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px dashed #eee; }
    .cart-item:last-child { border-bottom: none; }

    .cart-item-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .cart-item-name { font-weight: 600; }
    .cart-item-subtotal { font-weight: 600; color: var(--color-primary); }

    .cart-item-meta { font-size: 12px; color: #555; margin-bottom: 4px; }
    .cart-item-actions { display: flex; align-items: center; gap: 6px; font-size: 12px; }

    .qty-btn, .remove-btn {
      border: none;
      border-radius: 999px;
      padding: 2px 7px;
      cursor: pointer;
      font-size: 12px;
      background: #eee;
    }

    .qty-btn:hover { background: #ddd; }

    .remove-btn {
      background: #f8d7da;
      color: #900;
      margin-left: auto;
    }

    .remove-btn:hover { background: #f1b0b7; }

    .cart-item-qty { min-width: 18px; text-align: center; font-weight: 600; }

    .cart-empty { color: #777; font-size: 13px; text-align: center; padding: 10px 0; }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 700;
      margin-bottom: 10px;
      margin-top: 4px;
    }

    .cart-note { font-size: 11px; color: #777; margin-bottom: 8px; }

    .payment-methods { font-size: 11px; color: #555; margin-bottom: 10px; }
    .payment-methods strong { font-size: 12px; display: block; margin-bottom: 4px; }
    .payment-methods ul { margin: 0; padding-left: 18px; }
    .payment-methods li { margin-bottom: 2px; }

    .checkout-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .checkout-inputs input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
      width: 100%;
    }

    .btn-cart {
      width: 100%;
      text-align: center;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: var(--color-primary);
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
    }

    .btn-cart:hover { background: var(--color-primary-dark); }

    .btn-mp { background: #009ee3; margin-top: 6px; }
    .btn-mp:hover { background: #007bb8; }

    footer {
      padding: 22px 20px;
      text-align: center;
      font-size: 13px;
      color: #666;
    }

    @media (max-width: 980px){
      header{ padding: 10px 14px; }

      .top-bar{
        gap: 8px 14px;
        padding: 8px 10px;
        font-size: 12px;
      }
      .top-bar span{ white-space: normal; }

      .logo-img{ width:40px; height:40px; }
      .logo-text strong{ font-size:16px; }
      .logo-text span{ display:none !important; }

      .nav-inner{ max-width:none; width:100%; }

      .mobile-toggle{
        display:inline-flex;
        align-items:center;
        justify-content:center;
      }

      nav{
        position: fixed;
        top: 0;
        right: -92vw;
        width: min(90vw, 420px);
        max-width: 420px;
        height: 100vh;
        background: #000;
        display: flex;
        flex-direction: column;
        gap: 0;
        padding: 14px 14px 22px;
        border-left: 1px solid rgba(255,255,255,0.10);
        z-index: 9999;
        transition: right .18s ease;
        overflow-y: auto;
        align-items: stretch;
      }

      header.nav-open .nav-overlay{ display:block; }
      header.nav-open nav{ right: 0; }

      nav .nav-link{
        display:flex !important;
        width:100% !important;
        align-items:center;
        justify-content:space-between;
        padding: 14px 12px !important;
        margin: 0 !important;
        border: 0 !important;
        border-bottom: 1px solid rgba(255,255,255,0.10) !important;
        border-left: 3px solid transparent !important;
        text-align:left !important;
      }

      .nav-link:hover{
        border-color: transparent !important;
        color: #fff !important;
      }

      .nav-cta{
        margin-top: 12px;
        width:100%;
        justify-content:center;
        text-align:center;
        padding: 12px 16px !important;
      }
      .nav-link.nav-cta{
        border-bottom: none !important;
        border-left: none !important;
      }

      .nav-item{ width: 100%; }

      .nav-item:hover .dropdown{
        opacity: 0;
        pointer-events: none;
        transform: translateY(8px
)      }

      .dropdown{
        position: static !important;
        opacity: 1 !important;
        pointer-events: auto !important;
        transform: none !important;
        box-shadow: none !important;
        border-top: none !important;
        padding: 0 !important;
        margin: 0 !important;
        display: none !important;
      }
      .nav-item.open .dropdown{ display:block !important; }

      .dropdown a{
        padding: 12px 12px 12px 22px !important;
        font-size: 13px;
        border-bottom: 1px solid rgba(255,255,255,0.10) !important;
        text-align:left !important;
      }

      .hero{ padding: 46px 14px 42px; }
      .hero-inner { grid-template-columns: 1fr; gap: 18px; }
      .hero-title{ font-size: 30px; line-height: 1.05; }
      .hero-subtitle{ font-size: 14px; margin-bottom: 12px; }
      .hero-text{ font-size: 14px; max-width: 100%; }

      .hero-buttons .btn{
        display:flex;
        align-items:center;
        justify-content:center;
        text-align:center;
        width:100%;
        max-width: 520px;
        margin: 0;
      }

      .section{ padding: 36px 14px; }
      .section-title{ font-size: 22px; }
      .section-subtitle{ margin-bottom: 18px; }

      /* filtros y selects full en móvil */
      .filters select, .filters input[type="text"]{ max-width: none; }
    }

    @media (max-width: 520px){
      .hero-title{ font-size:28px; }
      .hero-text{ font-size:13px; }
      .section-title{ font-size:20px; }
    }
  </style>
</head>

<body>
  <div class="top-bar">
    <span>WhatsApp 11 3728-6846</span>
    <span>Industria argentina • Venta mayorista y minorista</span>
  </div>

  <header id="site-header">
    <div class="nav-inner">
      <a href="index.html" class="logo">
        <div class="logo-img"></div>
        <div class="logo-text">
          <strong>SEGUDAB</strong>
          <span>Equipamiento táctico y policial</span>
        </div>
      </a>

      <button class="mobile-toggle" id="mobile-toggle" aria-label="Abrir menú" aria-expanded="false">
        <span class="hamb" aria-hidden="true">
          <span></span><span></span><span></span>
        </span>
      </button>

      <div class="nav-overlay" id="nav-overlay" aria-hidden="true"></div>

      <nav id="main-nav" aria-label="Navegación principal">
        <a href="index.html" class="nav-link">Inicio</a>

        <div class="nav-item" id="nav-products">
          <a href="productos.html" class="nav-link" id="products-link" aria-expanded="false" aria-controls="products-dropdown">
            Productos <span class="caret">▼</span>
          </a>

          <div class="dropdown" id="products-dropdown">
            <a href="productos.html?cat=calzado">Calzado</a>
            <a href="productos.html?cat=correajes">Correajes</a>
            <a href="productos.html?cat=accesorios">Accesorios</a>
            <a href="productos.html?cat=indumentaria">Indumentaria</a>
          </div>
        </div>

        <a href="porque-elegirnos.html" class="nav-link">¿Por qué elegirnos?</a>
        <a href="contacto.html" class="nav-link nav-cta">Contactar</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="hero-inner">
      <div>
        <h1 class="hero-title">Catálogo de productos</h1>
        <p class="hero-subtitle">Botas, zapatos, correajes, accesorios e indumentaria</p>

        <p class="hero-text">
          Seleccioná los productos que necesitás y armá tu pedido. Luego podés enviarnos la consulta con el detalle
          para coordinar stock, formas de pago y retiro o envío.
        </p>

        <div class="hero-buttons">
          <a
            href="https://wa.me/5491137286846?text=Hola-Segudab,-quisiera-consultar-por-compras-mayoristas"
            class="btn btn-primary"
            target="_blank"
            rel="noopener"
          >
            Consulta mayorista
          </a>
        </div>
      </div>
    </div>
  </section>

  <div class="notice-bar">Insignias policiales se venden únicamente a personal de fuerzas con identificación.</div>

  <section class="section">
    <div class="section-inner">
      <h2 class="section-title">Catálogo completo</h2>
      <p class="section-subtitle">
        Catálogo orientativo. Los precios pueden variar según talle, modelo y cantidad. Consultá para presupuesto final.
      </p>
      <p class="section-subtitle" id="product-count-text"></p>
    </div>

    <!-- ✅ Filtros arriba, productos, carrito abajo -->
    <div class="catalog-layout">
      <div class="catalog-main">

        <!-- FILTROS -->
        <div class="filters">
          <h3>Filtrar productos</h3>

          <div class="filter-buttons">
            <button class="filter-btn active" data-category="all">Todos</button>
            <button class="filter-btn" data-category="calzado">Calzado</button>
            <button class="filter-btn" data-category="zapatos">Zapatos</button>
            <button class="filter-btn" data-category="borcegos">Borcegos</button>
            <button class="filter-btn" data-category="botines">Botines</button>
            <button class="filter-btn" data-category="correajes">Correajes</button>
            <button class="filter-btn" data-category="accesorios">Accesorios</button>
            <button class="filter-btn" data-category="indumentaria">Indumentaria</button>
          </div>

          <div class="filters-row">
            <label for="filter-search">Buscar producto:</label>
            <input type="text" id="filter-search" placeholder="Buscar por nombre o descripción" />
          </div>

          <div class="filters-row">
            <label for="filter-price">Filtrar por precio:</label>
            <select id="filter-price">
              <option value="all">Todos los precios</option>
              <option value="low">Menos de $20.000</option>
              <option value="mid">Entre $20.000 y $40.000</option>
              <option value="high">Más de $40.000</option>
            </select>

            <button id="clear-filters" type="button" class="filter-btn">
              Limpiar filtros
            </button>
          </div>
        </div>

        <!-- PRODUCTOS -->
        <div class="product-grid">

          <!-- ⬇️ Pegá acá TODOS tus product-card (no los dejo incompletos para no romper el HTML) -->
          <!-- Ejemplo: -->
          <!--
          <div class="product-card" data-category="indumentaria" ...>...</div>
          -->

        </div>

        <!-- CARRITO -->
        <aside class="cart-panel">
          <div class="cart-title">Carrito de compras (<span id="cart-count">0</span>)</div>

          <div id="cart-items" class="cart-items">
            <div class="cart-empty">Todavía no agregaste productos.</div>
          </div>

          <div class="cart-total">
            <span>Total estimado:</span>
            <span id="cart-total">$0</span>
          </div>

          <div class="cart-note">
            Este carrito es orientativo. Para confirmar precios, stock y medio de pago,
            completá tus datos y envianos el pedido.
          </div>

          <div class="payment-methods">
            <strong>Medios de pago:</strong>
            <ul>
              <li>Efectivo en el local</li>
              <li>Transferencia bancaria</li>
              <li>Tarjeta de crédito/débito y billeteras virtuales vía Mercado Pago</li>
            </ul>
          </div>

          <div class="cart-note" style="margin-top:8px; color:#900; font-weight:600;">
            ⚠️ Envíos al interior del país:<br>
            Se realizan únicamente por <strong>Vía Cargo</strong> y son a cargo del comprador.
            El costo de envío se abona al retirar la mercadería.
          </div>

          <div class="checkout-inputs">
            <input id="checkout-nombre" type="text" placeholder="Nombre y apellido" />
            <input id="checkout-telefono" type="text" placeholder="Teléfono" />
            <input id="checkout-email" type="email" placeholder="Correo (opcional)" />
          </div>

          <button class="btn-cart" type="button" onclick="finalizarCompraWhatsApp()">
            Enviar pedido por WhatsApp
          </button>

          <button class="btn-cart btn-mp" type="button" onclick="pagarConMercadoPago()">
            Pagar con Mercado Pago
          </button>
        </aside>

      </div>
    </div>
  </section>

  <footer>
    © 2025 Segudab — Todos los derechos reservados.
  </footer>

<script>
const header = document.getElementById('site-header');
const toggle = document.getElementById('mobile-toggle');
const nav = document.getElementById('main-nav');
const overlay = document.getElementById('nav-overlay');

const productsItem = document.getElementById('nav-products');
const productsLink = document.getElementById('products-link');

function isMobile() {
  return window.matchMedia('(max-width: 980px)').matches;
}

function setProductsExpanded(expanded) {
  productsItem.classList.toggle('open', expanded);
  productsLink.setAttribute('aria-expanded', String(expanded));
}

function openMenu() {
  header.classList.add('nav-open');
  toggle.setAttribute('aria-expanded', 'true');
  overlay.setAttribute('aria-hidden', 'false');
  document.documentElement.style.overflow = 'hidden';
  document.body.style.overflow = 'hidden';
}

function closeMenu() {
  header.classList.remove('nav-open');
  toggle.setAttribute('aria-expanded', 'false');
  overlay.setAttribute('aria-hidden', 'true');
  setProductsExpanded(false);
  document.documentElement.style.overflow = '';
  document.body.style.overflow = '';
}

toggle.addEventListener('click', () => {
  header.classList.contains('nav-open') ? closeMenu() : openMenu();
});

overlay.addEventListener('click', closeMenu);

productsLink.addEventListener('click', (e) => {
  if (!isMobile()) return;
  e.preventDefault();
  e.stopPropagation();
  setProductsExpanded(!productsItem.classList.contains('open'));
});

nav.addEventListener('click', (e) => {
  const link = e.target.closest('a');
  if (!link || !isMobile()) return;
  if (link.id === 'products-link') return;
  if (link.closest('.dropdown')) { closeMenu(); return; }
  closeMenu();
});

window.addEventListener('resize', () => {
  if (!isMobile()) closeMenu();
});

document.addEventListener('click', (e) => {
  if (!isMobile()) return;
  if (!productsItem.classList.contains('open')) return;
  if (productsItem.contains(e.target)) return;
  setProductsExpanded(false);
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && header.classList.contains('nav-open')) {
    closeMenu();
  }
});

const CART_KEY = 'segudab_cart';
let cart = [];
const MP_LINK = 'https://mpago.la/tu_link_de_pago';

function loadCart() {
  const stored = localStorage.getItem(CART_KEY);
  if (stored) cart = JSON.parse(stored) || [];
}

function saveCart() {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

function formatPrice(v) {
  return Number(v).toLocaleString('es-AR');
}

function renderCart() {
  const container = document.getElementById('cart-items');
  const count = document.getElementById('cart-count');
  const totalEl = document.getElementById('cart-total');

  container.innerHTML = '';

  if (!cart.length) {
    container.innerHTML = '<div class="cart-empty">Todavía no agregaste productos.</div>';
    count.textContent = '0';
    totalEl.textContent = '$0';
    return;
  }

  let total = 0;
  let qty = 0;

  cart.forEach(item => {
    total += item.price * item.qty;
    qty += item.qty;

    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <div class="cart-item-main">
        <span class="cart-item-name">${item.name}</span>
        <span class="cart-item-subtotal">$${formatPrice(item.price * item.qty)}</span>
      </div>
      <div class="cart-item-meta">Variante: ${item.size}</div>
      <div class="cart-item-actions">
        <button class="qty-btn" data-a="dec" data-n="${item.name}" data-s="${item.size}">−</button>
        <span class="cart-item-qty">${item.qty}</span>
        <button class="qty-btn" data-a="inc" data-n="${item.name}" data-s="${item.size}">+</button>
        <button class="remove-btn" data-a="rem" data-n="${item.name}" data-s="${item.size}">✕</button>
      </div>
    `;
    container.appendChild(div);
  });

  count.textContent = String(qty);
  totalEl.textContent = '$' + formatPrice(total);
}

function addToCart(name, price, size = 'A coordinar', qty = 1) {
  const item = cart.find(p => p.name === name && p.size === size);
  item ? item.qty += qty : cart.push({ name, price, size, qty });
  saveCart();
  renderCart();
}

document.getElementById('cart-items').addEventListener('click', e => {
  const b = e.target.closest('button');
  if (!b) return;

  const { a, n, s } = b.dataset;
  const item = cart.find(i => i.name === n && i.size === s);
  if (!item) return;

  if (a === 'inc') item.qty++;
  if (a === 'dec') item.qty = Math.max(1, item.qty - 1);
  if (a === 'rem') cart = cart.filter(i => !(i.name === n && i.size === s));

  saveCart();
  renderCart();
});

function setupProductCardClicks() {
  document.querySelectorAll('.product-card').forEach(card => {
    const btn = card.querySelector('.btn-small');
    btn?.addEventListener('click', e => {
      e.stopPropagation();
      addToCart(
        card.querySelector('.product-name').textContent.trim(),
        Number(card.dataset.price || 0)
      );
    });
  });
}

function applyCategoryFromUrl() {
  const params = new URLSearchParams(window.location.search);
  const cat = (params.get('cat') || '').toLowerCase();
  if (!cat) return;

  const map = {
    calzado: ['borcegos', 'zapatos', 'botines'],
    correajes: ['correajes'],
    accesorios: ['accesorios'],
    indumentaria: ['indumentaria']
  };

  const allowed = map[cat] || [cat];

  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  const btnToActivate = document.querySelector(`.filter-btn[data-category="${cat}"]`);
  if (btnToActivate) btnToActivate.classList.add('active');

  document.querySelectorAll('.product-card').forEach(card => {
    const c = (card.dataset.category || '').toLowerCase();
    card.style.display = allowed.includes(c) ? '' : 'none';
  });

  const sec = document.querySelector('.section');
  if (sec) sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

document.addEventListener('DOMContentLoaded', () => {
  loadCart();
  renderCart();
  setupProductCardClicks();
  applyCategoryFromUrl();
});
</script>

</body>
</html>
